<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Green Screen - Keep Face</title>
  <style>
    video, canvas { display:block; margin:10px auto; }
  </style>
  <!-- Load TensorFlow.js and Face API for face detection -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>
<body>
  <video id="video" width="640" height="480" autoplay muted></video>
  <canvas id="canvas" width="640" height="480"></canvas>
  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Start webcam
    navigator.mediaDevices.getUserMedia({ video:true })
      .then(stream => { video.srcObject = stream; });
    
    // Load face detection model
    Promise.all([
      faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models/')
    ]).then(() => {
      video.addEventListener('play', () => {
        setTimeout(processFrame, 500);
      });
    });
    
    async function processFrame() {
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      // Detect face
      const detections = await faceapi.detectSingleFace(
        canvas, new faceapi.TinyFaceDetectorOptions()
      );
      let frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
      let data = frame.data;
      // By default, paint whole image white
      for(let i=0; i<data.length; i+=4) {
        data[i]=255; data[i+1]=255; data[i+2]=255; // Set to white
      }
      // If a face is detected, restore that area from the video
      if(detections) {
        let box = detections.box;
        ctx.drawImage(video, box.x, box.y, box.width, box.height, box.x, box.y, box.width, box.height);
      }
      ctx.putImageData(frame,0,0);
      setTimeout(processFrame,40);
    }
  </script>
</body>
</html>

